WITH RECURSIVE date_range AS (
  SELECT CAST(? AS DATE) AS BUSINESS_DATE FROM dual
  UNION ALL
  SELECT BUSINESS_DATE - 1 FROM date_range WHERE NOT EXISTS (SELECT 1 FROM OFFICE WHERE BUSINESS_DATE = date_range.BUSINESS_DATE - 1)
)
SELECT BUSINESS_DATE
FROM date_range
WHERE EXISTS (SELECT 1 FROM OFFICE WHERE BUSINESS_DATE = date_range.BUSINESS_DATE)
AND ROWNUM = 1;




WITH RECURSIVE date_range AS (
  SELECT CAST('2024-05-08' AS DATE) AS BUSINESS_DATE FROM dual -- Replace '2024-05-08' with your actual date value
  UNION ALL
  SELECT BUSINESS_DATE - 1 FROM date_range WHERE NOT EXISTS (SELECT 1 FROM OFFICE WHERE BUSINESS_DATE = date_range.BUSINESS_DATE - 1)
)
SELECT BUSINESS_DATE
FROM date_range
WHERE EXISTS (SELECT 1 FROM OFFICE WHERE BUSINESS_DATE = date_range.BUSINESS_DATE)
AND ROWNUM = 1;


SELECT BUSINESS_DATE
FROM (
    SELECT LEVEL - 1 AS LVL,
           CAST(? AS DATE) - (LEVEL - 1) AS BUSINESS_DATE
    FROM dual
    CONNECT BY LEVEL <= (SELECT MAX(BUSINESS_DATE - MIN(BUSINESS_DATE) + 1) FROM OFFICE)
) date_range
WHERE EXISTS (SELECT 1 FROM OFFICE WHERE BUSINESS_DATE = date_range.BUSINESS_DATE)
AND ROWNUM = 1;
